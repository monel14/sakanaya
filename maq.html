<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maquette Sakanaya V4 - Unifiée</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #3b82f6;
            --primary-hover: #2563eb;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }

        .sidebar {
            transition: transform 0.3s ease-in-out;
        }

        .sidebar-closed {
            transform: translateX(-100%);
        }

        .content-area {
            transition: margin-left 0.3s ease-in-out;
        }

        .table-header th {
            background-color: #e2e8f0;
            padding: 12px;
            border-bottom: 2px solid #cbd5e1;
        }

        .table-row td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .table-row:hover {
            background-color: #f7fafc;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #4b5563;
        }

        .btn-danger {
            background-color: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .btn-success {
            background-color: #22c55e;
            color: white;
        }

        .btn-success:hover {
            background-color: #16a34a;
        }

        .card {
            background-color: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 24px;
        }

        .card-header {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: #1f2937;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 1rem;
        }

        input,
        select,
        textarea {
            border: 1px solid #cbd5e1;
            padding: 10px;
            border-radius: 6px;
            width: 100%;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
            outline: none;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 25px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding-bottom: 15px;
            border-bottom: 1px solid #e5e5e5;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .modal-body {
            padding: 15px 0;
        }

        .modal-footer {
            padding-top: 15px;
            border-top: 1px solid #e5e5e5;
            text-align: right;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .view-content {
            display: none;
        }

        .view-content.active {
            display: block;
        }

        .nav-link.active {
            background-color: #4a5568;
            font-weight: 600;
        }

        .tab-button {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
        }

        .tab-button.active {
            background-color: var(--primary-color);
            color: white;
        }
    </style>
</head>

<body class="text-gray-800">

    <div id="loginPage"
        class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-600 p-4">
        <div class="card w-full max-w-md">
            <div class="card-header text-center text-2xl font-bold text-gray-700 !border-0"><i
                    class="fas fa-fish mr-2 text-blue-500"></i>Sakanaya</div>
            <form id="loginForm">
                <div class="mb-4">
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Identifiant</label>
                    <input type="text" id="username" value="directeur" class="w-full" placeholder="Votre identifiant">
                </div>
                <div class="mb-4">
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Mot de passe</label>
                    <input type="password" id="password" value="password" class="w-full"
                        placeholder="Votre mot de passe">
                </div>
                <div class="mb-4 text-xs text-gray-600 bg-blue-50 p-2 rounded">
                    <i class="fas fa-info-circle mr-1"></i>
                    <strong>Démo:</strong> Utilisez "directeur/password" ou "almadies/password"
                </div>
                <button type="submit" class="btn btn-primary w-full">
                    <i class="fas fa-sign-in-alt mr-2"></i>Se Connecter
                </button>
            </form>
        </div>
    </div>

    <div id="app" class="hidden">
        <header class="bg-white shadow-md sticky top-0 z-50">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <div class="flex items-center"><button id="menuToggle"
                        class="text-gray-600 hover:text-blue-500 focus:outline-none lg:hidden mr-3"><i
                            class="fas fa-bars text-xl"></i></button>
                    <h1 class="text-xl font-semibold text-gray-700"><i class="fas fa-fish text-blue-500"></i> Sakanaya
                    </h1>
                </div>
                <div class="flex items-center">
                    <div class="mr-4"><button class="btn btn-secondary btn-sm !py-1.5" onclick="switchUserRole()"><i
                                class="fas fa-repeat mr-2"></i>Basculer la vue</button></div>
                    <span id="currentUser" class="text-sm text-gray-600 mr-4"></span>
                    <button onclick="logout()" class="btn btn-secondary btn-sm !py-1.5"><i
                            class="fas fa-sign-out-alt mr-1"></i>Déconnexion</button>
                </div>
            </div>
        </header>

        <div class="flex">
            <aside id="sidebar"
                class="sidebar bg-gray-800 text-white w-64 min-h-screen p-4 space-y-2 fixed lg:static lg:transform-none sidebar-closed lg:sidebar-open z-40">
                <nav id="director-nav" class="space-y-1">
                    <h3 class="text-xs uppercase text-gray-400 font-semibold mb-2 px-4">Pilotage</h3>
                    <a href="#" class="nav-link flex items-center py-2.5 px-4 rounded-lg hover:bg-gray-700"
                        onclick="showView('director-dashboard', this)"><i
                            class="fas fa-tachometer-alt w-5 mr-3"></i>Tableau de Bord</a>
                    <a href="#" class="nav-link flex items-center py-2.5 px-4 rounded-lg hover:bg-gray-700"
                        onclick="showView('reports-view', this)"><i class="fas fa-chart-bar w-5 mr-3"></i>Rapports &
                        Analyses</a>
                    <h3 class="text-xs uppercase text-gray-400 font-semibold mt-4 mb-2 px-4">Gestion</h3>
                    <a href="#" class="nav-link flex items-center py-2.5 px-4 rounded-lg hover:bg-gray-700"
                        onclick="showView('stock-management', this)"><i class="fas fa-boxes w-5 mr-3"></i>Gestion des
                        Stocks</a>
                    <a href="#" class="nav-link flex items-center py-2.5 px-4 rounded-lg hover:bg-gray-700"
                        onclick="showView('product-management', this)"><i
                            class="fas fa-dollar-sign w-5 mr-3"></i>Produits & Prix</a>
                    <a href="#" class="nav-link flex items-center py-2.5 px-4 rounded-lg hover:bg-gray-700"
                        onclick="showView('hr-management', this)"><i class="fas fa-users w-5 mr-3"></i>Ressources
                        Humaines</a>
                    <h3 class="text-xs uppercase text-gray-400 font-semibold mt-4 mb-2 px-4">Administration</h3>
                    <a href="#" class="nav-link flex items-center py-2.5 px-4 rounded-lg hover:bg-gray-700"
                        onclick="showView('admin-view', this)"><i class="fas fa-cogs w-5 mr-3"></i>Paramètres</a>
                </nav>
                <nav id="store-nav" class="space-y-1">
                    <h3 class="text-xs uppercase text-gray-400 font-semibold mb-2 px-4">Opérations</h3>
                    <a href="#" class="nav-link flex items-center py-2.5 px-4 rounded-lg hover:bg-gray-700"
                        onclick="showView('store-dashboard', this)"><i class="fas fa-store w-5 mr-3"></i>Mon Magasin</a>
                    <a href="#" class="nav-link flex items-center py-2.5 px-4 rounded-lg hover:bg-gray-700"
                        onclick="showView('sales-entry', this)"><i class="fas fa-cash-register w-5 mr-3"></i>Saisie des
                        Ventes</a>
                    <a href="#" class="nav-link flex items-center py-2.5 px-4 rounded-lg hover:bg-gray-700"
                        onclick="showView('stock-management', this)"><i class="fas fa-boxes w-5 mr-3"></i>Mon Stock</a>
                    <a href="#" class="nav-link flex items-center py-2.5 px-4 rounded-lg hover:bg-gray-700"
                        onclick="showView('hr-management', this)"><i
                            class="fas fa-user-check w-5 mr-3"></i>Présences</a>
                </nav>
            </aside>

            <main id="mainContent" class="content-area flex-1 p-6 lg:ml-50">
                <!-- Director Dashboard -->
                <div id="director-dashboard" class="view-content">
                    <div class="card-header"><i class="fas fa-tachometer-alt mr-2"></i>Tableau de Bord Global</div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="card">
                            <p class="text-gray-500 text-sm">Chiffre d'Affaires (jour)</p>
                            <p class="text-2xl font-bold">1 250 000 CFA</p>
                        </div>
                        <div class="card">
                            <p class="text-gray-500 text-sm">Marge Brute (jour)</p>
                            <p class="text-2xl font-bold">480 000 CFA</p>
                        </div>
                        <div class="card">
                            <p class="text-gray-500 text-sm">Taux de perte (jour)</p>
                            <p class="text-2xl font-bold">2.8%</p>
                        </div>
                        <div class="card">
                            <p class="text-gray-500 text-sm">Rotation de stock (moy)</p>
                            <p class="text-2xl font-bold">2.3 jours</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                        <div class="lg:col-span-3 card">
                            <h3 class="font-semibold mb-4">CA par Magasin (7 derniers jours)</h3>
                            <canvas id="caChart"></canvas>
                        </div>
                        <div class="lg:col-span-2 card">
                            <h3 class="font-semibold mb-4"><i class="fas fa-bell text-yellow-500 mr-2"></i>Alertes &
                                Tâches</h3>
                            <ul class="space-y-3">
                                <li class="p-2 bg-red-50 rounded-lg text-sm">Clôture manquante J-1: Magasin Sandaga</li>
                                <li class="p-2 bg-blue-50 rounded-lg text-sm">Valider transfert #BT-0128 vers Almadies
                                </li>
                                <li class="p-2 bg-yellow-50 rounded-lg text-sm">Sur-stock de Soles au Hub (+25kg)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Store Dashboard -->
                <div id="store-dashboard" class="view-content">
                    <div class="card-header" id="store-dashboard-header"></div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <button class="card text-center hover:bg-blue-50 transition"
                            onclick="showView('sales-entry')"><i
                                class="fas fa-cash-register mx-auto text-blue-600 h-10 w-10 mb-2"></i>
                            <h2 class="font-semibold text-lg">Saisir les Ventes</h2>
                        </button>
                        <button class="card text-center hover:bg-green-50 transition"
                            onclick="showView('stock-management')"><i
                                class="fas fa-boxes mx-auto text-green-600 h-10 w-10 mb-2"></i>
                            <h2 class="font-semibold text-lg">Gérer le Stock</h2>
                        </button>
                        <button class="card text-center hover:bg-yellow-50 transition"
                            onclick="showView('hr-management')"><i
                                class="fas fa-user-check mx-auto text-yellow-600 h-10 w-10 mb-2"></i>
                            <h2 class="font-semibold text-lg">Pointer les Présences</h2>
                        </button>
                    </div>
                    <div class="card">
                        <h2 class="text-xl font-semibold mb-4">Notifications & Informations</h2>
                        <div class="flex items-start p-3 bg-blue-50 rounded-lg">
                            <i class="fas fa-truck text-blue-600 mr-3 mt-1 flex-shrink-0"></i>
                            <div>
                                <p class="font-medium">Arrivage en attente de validation</p>
                                <p class="text-sm text-gray-600">Bon de transfert #BT-0128 du Hub. 15kg de Thon, 10kg de
                                    Crevettes.</p>
                                <button class="text-sm text-blue-600 font-semibold mt-1"
                                    onclick="showView('stock-management')">Valider la réception</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sales Entry -->
                <div id="sales-entry" class="view-content card">
                    <div class="card-header flex justify-between items-center">
                        <span><i class="fas fa-cash-register mr-2"></i>Saisie Journalière des Ventes</span>
                        <span class="text-sm font-normal" id="saisieInfo"></span>
                    </div>
                    <div class="overflow-x-auto mb-4">
                        <table class="min-w-full bg-white">
                            <thead class="table-header">
                                <tr>
                                    <th>Produit (Unité de vente)</th>
                                    <th class="text-right">Prix Unitaire</th>
                                    <th class="text-center w-1/4">Quantité Vendue</th>
                                    <th class="text-right">Sous-total</th>
                                    <th class="text-center">Action</th>
                                </tr>
                            </thead>
                            <tbody id="saisieTableBody"></tbody>
                        </table>
                    </div>
                    <div class="flex justify-start mb-4">
                        <button onclick="ajouterLigneSaisie()" class="btn btn-primary btn-sm"><i
                                class="fas fa-plus mr-2"></i>Ajouter une ligne</button>
                    </div>
                    <div class="text-right font-bold text-xl mb-4">Total Journalier: <span id="totalJournalier"
                            class="text-blue-600">0.00 CFA</span></div>
                    <div class="flex justify-end"><button class="btn btn-primary"><i
                                class="fas fa-save mr-2"></i>Clôturer la journée</button></div>
                </div>

                <!-- Reports View -->
                <div id="reports-view" class="view-content card">
                    <div class="card-header"><i class="fas fa-chart-bar mr-2"></i>Rapports & Analyses</div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div><label class="text-sm font-medium">Type de Rapport</label><select class="mt-1">
                                <option>Performance des Ventes</option>
                                <option>Analyse des Stocks</option>
                                <option>Rapport RH</option>
                            </select></div>
                        <div><label class="text-sm font-medium">Période</label><select class="mt-1">
                                <option>7 derniers jours</option>
                                <option>Ce mois</option>
                                <option>Mois dernier</option>
                            </select></div>
                        <div><label class="text-sm font-medium">Magasin</label><select class="mt-1">
                                <option>Tous les magasins</option>
                                <option>Hub de Distribution</option>
                                <option>Pointe des Almadies</option>
                            </select></div>
                        <div class="self-end"><button class="btn btn-primary w-full">Générer</button></div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <h3 class="font-semibold mb-2">Analyse du CA par produit</h3><canvas
                                id="productPerfChart"></canvas>
                        </div>
                        <div>
                            <h3 class="font-semibold mb-2">Données brutes</h3>
                            <div class="flex justify-end mb-2"><button class="btn btn-success btn-sm"><i
                                        class="fas fa-file-excel mr-2"></i>Exporter (CSV)</button></div>
                            <table class="w-full text-sm">
                                <thead class="table-header">
                                    <tr>
                                        <th>Produit</th>
                                        <th class="text-right">Volume (Kg)</th>
                                        <th class="text-right">CA (CFA)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="table-row">
                                        <td>Thon Rouge</td>
                                        <td class="text-right">150.5</td>
                                        <td class="text-right">978 250</td>
                                    </tr>
                                    <tr class="table-row">
                                        <td>Crevettes</td>
                                        <td class="text-right">88.2</td>
                                        <td class="text-right">705 600</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Stock Management -->
                <div id="stock-management" class="view-content">
                    <!-- Director Stock View -->
                    <div id="director-stock-view">
                        <div class="card-header"><i class="fas fa-warehouse mr-2"></i>Pilotage Global des Stocks</div>
                        <div class="flex space-x-2 mb-4 border-b">
                            <button class="tab-button active"
                                onclick="switchTab(this, 'stock-tabs', 'stock-overview')">Vue d'ensemble</button>
                            <button class="tab-button"
                                onclick="switchTab(this, 'stock-tabs', 'stock-transfers')">Transferts</button>
                            <button class="tab-button"
                                onclick="switchTab(this, 'stock-tabs', 'stock-arrivals')">Arrivages
                                Fournisseurs</button>
                        </div>
                        <div id="stock-tabs">
                            <div id="stock-overview" class="tab-content active">
                                <h3 class="font-semibold text-lg mb-4">État des stocks en temps réel</h3>
                                <canvas id="stockDistributionChart"></canvas>
                            </div>
                            <div id="stock-transfers" class="tab-content hidden">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="font-semibold text-lg">Suivi des Transferts Inter-Magasins</h3>
                                    <button class="btn btn-primary"><i class="fas fa-plus mr-2"></i>Nouveau
                                        Transfert</button>
                                </div>
                                <table class="w-full text-sm">
                                    <thead class="table-header">
                                        <tr>
                                            <th>#Bon</th>
                                            <th>De</th>
                                            <th>Vers</th>
                                            <th>Statut</th>
                                            <th>Date</th>
                                            <th class="text-center">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="table-row">
                                            <td>BT-0128</td>
                                            <td>Hub</td>
                                            <td>Almadies</td>
                                            <td><span
                                                    class="px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800">En
                                                    Transit</span></td>
                                            <td>04/08/2025</td>
                                            <td class="text-center"><button class="text-blue-500 text-xs">Voir</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div id="stock-arrivals" class="tab-content hidden">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="font-semibold text-lg">Historique des Arrivages Fournisseurs</h3>
                                    <button onclick="openModal('modalNouvelArrivage')" class="btn btn-primary">
                                        <i class="fas fa-plus mr-2"></i>Nouvel Arrivage
                                    </button>
                                </div>
                                <table class="w-full text-sm">
                                    <thead class="table-header">
                                        <tr>
                                            <th>Date</th>
                                            <th>Fournisseur</th>
                                            <th>Produits</th>
                                            <th class="text-right">Quantité Totale</th>
                                            <th class="text-center">Statut</th>
                                            <th class="text-center">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="table-row">
                                            <td>04/08/2025</td>
                                            <td>Pêcheurs de Kayar</td>
                                            <td>Thon Rouge, Crevettes</td>
                                            <td class="text-right">125.5 kg</td>
                                            <td class="text-center">
                                                <span
                                                    class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">Validé</span>
                                            </td>
                                            <td class="text-center">
                                                <button class="text-blue-500 text-xs">Détails</button>
                                            </td>
                                        </tr>
                                        <tr class="table-row">
                                            <td>03/08/2025</td>
                                            <td>Coopérative Soumbédioune</td>
                                            <td>Soles, Bars, Sardines</td>
                                            <td class="text-right">89.2 kg</td>
                                            <td class="text-center">
                                                <span
                                                    class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">Validé</span>
                                            </td>
                                            <td class="text-center">
                                                <button class="text-blue-500 text-xs">Détails</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- Store Stock View -->
                    <div id="store-stock-view">
                        <div class="card-header"><i class="fas fa-boxes mr-2"></i>Gestion de mon Stock (Almadies)</div>
                        <div class="card">
                            <h3 class="font-semibold text-lg mb-3"><i
                                    class="fas fa-truck-loading mr-2 text-blue-500"></i>Réception en attente</h3>
                            <div class="p-4 border border-blue-300 rounded-lg bg-blue-50">
                                <p class="font-medium mb-2">Bon de Transfert #BT-0128 (depuis Hub)</p>
                                <p class="text-sm">Thon: 15kg | Crevettes: 10kg</p>
                                <button class="btn btn-primary mt-3 w-full"><i class="fas fa-check mr-2"></i>Contrôler &
                                    Valider la Réception</button>
                            </div>
                        </div>
                        <div class="card">
                            <h4 class="font-semibold text-lg mb-3"><i
                                    class="fas fa-times-circle mr-2 text-red-500"></i>Déclaration des Pertes & Invendus
                            </h4>
                            <div class="space-y-3">
                                <div><label class="block text-sm font-medium">Produit</label><select
                                        class="w-full"></select></div>
                                <div><label class="block text-sm font-medium">Quantité Invendue</label><input
                                        type="number" placeholder="Ex: 2.3" class="w-full"></div>
                                <div><label class="block text-sm font-medium">Catégorie</label><select class="w-full">
                                        <option value="perte">Perte</option>
                                        <option value="demarque">Démarque</option>
                                    </select></div>
                                <button class="btn btn-danger w-full"><i
                                        class="fas fa-exclamation-triangle mr-2"></i>Déclarer Invendu</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Product & Price Management -->
                <div id="product-management" class="view-content">
                    <div class="card">
                        <div class="card-header"><i class="fas fa-dollar-sign mr-2"></i>Mise à Jour des Prix du Jour
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Modifiez les prix des produits variables. Les changements
                            seront appliqués immédiatement.</p>
                        <table class="w-full text-sm">
                            <thead class="table-header">
                                <tr>
                                    <th>Produit</th>
                                    <th class="text-right">Prix Actuel (CFA)</th>
                                    <th class="text-right w-1/4">Nouveau Prix (CFA)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="table-row">
                                    <td>Thon Rouge</td>
                                    <td class="text-right">6 500 / kg</td>
                                    <td class="text-right"><input type="number" class="text-right" value="6500"></td>
                                </tr>
                                <tr class="table-row">
                                    <td>Crevettes Roses</td>
                                    <td class="text-right">8 000 / kg</td>
                                    <td class="text-right"><input type="number" class="text-right" value="8200"></td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="flex justify-between items-center mt-4">
                            <div class="text-sm text-gray-600">
                                <i class="fas fa-calendar mr-1"></i>
                                Dernière mise à jour: 05/08/2025 à 06:30
                            </div>
                            <button class="btn btn-primary" onclick="validerNouveauxPrix()">
                                <i class="fas fa-check mr-2"></i>Valider les nouveaux prix
                            </button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header flex justify-between items-center"><span><i
                                    class="fas fa-package mr-2"></i>Catalogue Produits</span><button
                                onclick="openModal('modalAjoutProduit')" class="btn btn-primary btn-sm"><i
                                    class="fas fa-plus mr-2"></i>Ajouter Produit</button></div>
                        <table class="w-full text-sm">
                            <thead class="table-header">
                                <tr>
                                    <th>Nom Produit</th>
                                    <th>Unité de Stock</th>
                                    <th>Prix Variable</th>
                                    <th class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="catalogueProduitsTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- HR Management -->
                <div id="hr-management" class="view-content">
                    <div id="director-hr-view">
                        <div class="card">
                            <div class="card-header flex justify-between items-center"><span><i
                                        class="fas fa-users mr-2"></i>Gestion des Employés</span><button
                                    onclick="openModal('modalAjoutEmploye')" class="btn btn-primary btn-sm"><i
                                        class="fas fa-user-plus mr-2"></i>Nouvel Employé</button></div>
                            <table class="w-full text-sm">
                                <thead class="table-header">
                                    <tr>
                                        <th>Nom</th>
                                        <th>Magasin</th>
                                        <th>Rôle</th>
                                        <th class="text-right">Salaire</th>
                                        <th class="text-center">Statut</th>
                                        <th class="text-center">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="employeeTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                    <div id="store-hr-view">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-user-check mr-2"></i>Pointage des Présences - Almadies
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Date</label>
                                <input type="date" id="datePointage" class="w-full max-w-xs" value="2025-08-05">
                            </div>
                            <table class="w-full text-sm">
                                <thead class="table-header">
                                    <tr>
                                        <th>Employé</th>
                                        <th>Rôle</th>
                                        <th class="text-center">Présent</th>
                                        <th class="text-center">Heure d'Arrivée</th>
                                        <th class="text-center">Heure de Départ</th>
                                        <th>Commentaires</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="table-row">
                                        <td>Amadou Diallo</td>
                                        <td>Responsable</td>
                                        <td class="text-center">
                                            <input type="checkbox" checked class="w-4 h-4">
                                        </td>
                                        <td class="text-center">
                                            <input type="time" value="08:00" class="text-sm p-1 border rounded">
                                        </td>
                                        <td class="text-center">
                                            <input type="time" value="18:00" class="text-sm p-1 border rounded">
                                        </td>
                                        <td>
                                            <input type="text" placeholder="Commentaires..."
                                                class="w-full text-sm p-1 border rounded">
                                        </td>
                                    </tr>
                                    <tr class="table-row">
                                        <td>Aïcha Ndiaye</td>
                                        <td>Vendeur</td>
                                        <td class="text-center">
                                            <input type="checkbox" checked class="w-4 h-4">
                                        </td>
                                        <td class="text-center">
                                            <input type="time" value="08:30" class="text-sm p-1 border rounded">
                                        </td>
                                        <td class="text-center">
                                            <input type="time" value="17:30" class="text-sm p-1 border rounded">
                                        </td>
                                        <td>
                                            <input type="text" class="w-full text-sm p-1 border rounded">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="flex justify-end mt-4">
                                <button class="btn btn-primary">
                                    <i class="fas fa-save mr-2"></i>Enregistrer les Présences
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin View -->
                <div id="admin-view" class="view-content card">
                    <div class="card-header"><i class="fas fa-cogs mr-2"></i>Administration</div>
                    <div class="flex space-x-2 mb-4 border-b">
                        <button class="tab-button active"
                            onclick="switchTab(this, 'admin-tabs', 'admin-users')">Utilisateurs</button>
                        <button class="tab-button"
                            onclick="switchTab(this, 'admin-tabs', 'admin-stores')">Magasins</button>
                        <button class="tab-button" onclick="switchTab(this, 'admin-tabs', 'admin-logs')">Logs
                            d'Audit</button>
                    </div>
                    <div id="admin-tabs">
                        <div id="admin-users" class="tab-content active">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-semibold text-lg">Gestion des Comptes Utilisateurs</h3>
                                <button onclick="openModal('modalAjoutUtilisateur')" class="btn btn-primary btn-sm"><i
                                        class="fas fa-user-plus mr-2"></i>Ajouter Utilisateur</button>
                            </div>
                            <table class="w-full text-sm">
                                <thead class="table-header">
                                    <tr>
                                        <th>Nom</th>
                                        <th>Identifiant</th>
                                        <th>Rôle</th>
                                        <th>Magasin</th>
                                        <th class="text-center">Statut</th>
                                        <th class="text-center">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody"></tbody>
                            </table>
                        </div>
                        <div id="admin-stores" class="tab-content hidden">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-semibold text-lg">Gestion des Points de Vente & Hubs</h3>
                                <button onclick="openModal('modalAjoutMagasin')" class="btn btn-primary btn-sm">
                                    <i class="fas fa-store mr-2"></i>Nouveau Magasin
                                </button>
                            </div>
                            <table class="w-full text-sm">
                                <thead class="table-header">
                                    <tr>
                                        <th>Nom</th>
                                        <th>Type</th>
                                        <th>Adresse</th>
                                        <th class="text-center">Statut</th>
                                        <th class="text-center">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="storesTableBody"></tbody>
                            </table>
                        </div>
                        <div id="admin-logs" class="tab-content hidden">
                            <h3 class="font-semibold text-lg mb-4">Journal des Actions</h3>
                            <table class="w-full text-sm">
                                <thead class="table-header">
                                    <tr>
                                        <th>Date</th>
                                        <th>Utilisateur</th>
                                        <th>Action</th>
                                        <th>Détails</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="table-row">
                                        <td>04/08/2025 17:10</td>
                                        <td>directeur</td>
                                        <td>MODIF_PRIX</td>
                                        <td>Thon Rouge: 6500 -> 6800</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="modalAjoutProduit" class="modal">
        <div class="modal-content !max-w-3xl">
            <div class="modal-header"><span id="modalProduitTitle">Ajouter un Produit</span><span class="close-button"
                    onclick="closeModal('modalAjoutProduit')">&times;</span></div>
            <div class="modal-body">
                <form id="formProduit">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium">Nom du Produit</label><input type="text"
                                id="produitNom" value="Thon Rouge"></div>
                        <div><label class="block text-sm font-medium">Unité de Stock</label><select id="produitUnite">
                                <option value="kg">Kilogramme (kg)</option>
                            </select></div>
                    </div>
                    <div class="mt-4"><label class="block text-sm font-medium">Type de Prix</label><select>
                            <option>Variable (mis à jour quotidiennement)</option>
                            <option>Fixe</option>
                        </select></div>
                    <div class="mt-6 pt-4 border-t">
                        <h3 class="font-semibold mb-2">Unités de Vente</h3>
                        <p class="text-xs text-gray-500 mb-3">Définissez comment ce produit est vendu. Chaque vente
                            décrémentera le stock principal selon le facteur de conversion.</p>
                        <div id="unitesDeVenteContainer">
                            <div class="grid grid-cols-12 gap-2 items-center mb-2 p-2 bg-gray-50 rounded">
                                <div class="col-span-5"><label class="text-xs">Nom</label><input type="text"
                                        value="Thon au Kg"></div>
                                <div class="col-span-3"><label class="text-xs">Prix Vente (CFA)</label><input
                                        type="number" value="6500"></div>
                                <div class="col-span-3"><label class="text-xs">Facteur / Unité de Stock</label><input
                                        type="number" value="1"></div>
                                <div class="col-span-1 self-end"><button type="button"
                                        class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                            <div class="grid grid-cols-12 gap-2 items-center mb-2 p-2 bg-gray-50 rounded">
                                <div class="col-span-5"><input type="text" value="Pack de Thon"></div>
                                <div class="col-span-3"><input type="number" value="3500"></div>
                                <div class="col-span-3"><input type="number" value="0.5"></div>
                                <div class="col-span-1 self-end"><button type="button"
                                        class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div><button type="button" class="btn btn-secondary btn-sm mt-2"><i
                                class="fas fa-plus mr-2"></i>Ajouter une unité de vente</button>
                    </div>
                </form>
            </div>
            <div class="modal-footer"><button type="button" class="btn btn-secondary mr-2"
                    onclick="closeModal('modalAjoutProduit')">Annuler</button><button type="button"
                    class="btn btn-primary">Sauvegarder Produit</button></div>
        </div>
    </div>
    <div id="modalAjoutUtilisateur" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span id="modalUtilisateurTitle">Ajouter un Utilisateur</span>
                <span class="close-button" onclick="closeModal('modalAjoutUtilisateur')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="formUtilisateur">
                    <div class="mb-4">
                        <label class="block text-sm font-medium">Nom Complet</label>
                        <input type="text" id="utilisateurNomComplet" class="w-full">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium">Identifiant</label>
                        <input type="text" id="utilisateurIdentifiant" class="w-full">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium">Rôle</label>
                        <select id="utilisateurRole" class="w-full">
                            <option value="directeur">Directeur</option>
                            <option value="magasin">Magasin</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium">Magasin Associé</label>
                        <select id="utilisateurMagasin" class="w-full">
                            <option value="">Tous les magasins</option>
                            <option value="hub">Hub de Distribution</option>
                            <option value="almadies">Pointe des Almadies</option>
                            <option value="sandaga">Sandaga</option>
                            <option value="mermoz">Mermoz</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium">Mot de passe temporaire</label>
                        <input type="password" id="utilisateurMotDePasse" class="w-full" value="password123">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary mr-2"
                    onclick="closeModal('modalAjoutUtilisateur')">Annuler</button>
                <button type="button" class="btn btn-primary" onclick="ajouterUtilisateur()">Créer Utilisateur</button>
            </div>
        </div>
    </div>

    <div id="modalAjoutEmploye" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span id="modalEmployeTitle">Ajouter un Employé</span>
                <span class="close-button" onclick="closeModal('modalAjoutEmploye')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="formEmploye">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium">Nom Complet</label>
                            <input type="text" id="employeNom" class="w-full">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Téléphone</label>
                            <input type="tel" id="employeTelephone" class="w-full">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div>
                            <label class="block text-sm font-medium">Magasin Principal</label>
                            <select id="employeMagasin" class="w-full">
                                <option value="hub">Hub de Distribution</option>
                                <option value="almadies">Pointe des Almadies</option>
                                <option value="sandaga">Sandaga</option>
                                <option value="mermoz">Mermoz</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Rôle</label>
                            <select id="employeRole" class="w-full">
                                <option value="vendeur">Vendeur</option>
                                <option value="responsable">Responsable Magasin</option>
                                <option value="preparateur">Préparateur</option>
                                <option value="caissier">Caissier</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div>
                            <label class="block text-sm font-medium">Salaire Mensuel (CFA)</label>
                            <input type="number" id="employeSalaire" class="w-full" placeholder="Ex: 150000">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Date d'Embauche</label>
                            <input type="date" id="employeDateEmbauche" class="w-full">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium">Jours de Travail</label>
                        <div class="flex flex-wrap gap-2 mt-2">
                            <label class="flex items-center"><input type="checkbox" value="lundi" class="mr-1">
                                Lundi</label>
                            <label class="flex items-center"><input type="checkbox" value="mardi" class="mr-1">
                                Mardi</label>
                            <label class="flex items-center"><input type="checkbox" value="mercredi" class="mr-1">
                                Mercredi</label>
                            <label class="flex items-center"><input type="checkbox" value="jeudi" class="mr-1">
                                Jeudi</label>
                            <label class="flex items-center"><input type="checkbox" value="vendredi" class="mr-1">
                                Vendredi</label>
                            <label class="flex items-center"><input type="checkbox" value="samedi" class="mr-1">
                                Samedi</label>
                            <label class="flex items-center"><input type="checkbox" value="dimanche" class="mr-1">
                                Dimanche</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary mr-2"
                    onclick="closeModal('modalAjoutEmploye')">Annuler</button>
                <button type="button" class="btn btn-primary" onclick="ajouterEmploye()">Créer Employé</button>
            </div>
        </div>
    </div>

    <div id="modalAjoutMagasin" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span>Ajouter un Magasin</span>
                <span class="close-button" onclick="closeModal('modalAjoutMagasin')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="formMagasin">
                    <div class="mb-4">
                        <label class="block text-sm font-medium">Nom du Magasin</label>
                        <input type="text" id="magasinNom" class="w-full" placeholder="Ex: Plateau Centre">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium">Type</label>
                        <select id="magasinType" class="w-full">
                            <option value="magasin">Magasin</option>
                            <option value="hub">Hub de Distribution</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium">Adresse</label>
                        <textarea id="magasinAdresse" class="w-full" rows="3" placeholder="Adresse complète"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium">Téléphone</label>
                        <input type="tel" id="magasinTelephone" class="w-full" placeholder="Ex: +221 77 123 45 67">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary mr-2"
                    onclick="closeModal('modalAjoutMagasin')">Annuler</button>
                <button type="button" class="btn btn-primary" onclick="ajouterMagasin()">Créer Magasin</button>
            </div>
        </div>
    </div>

    <div id="modalNouvelArrivage" class="modal">
        <div class="modal-content !max-w-4xl">
            <div class="modal-header">
                <span>Nouvel Arrivage Fournisseur</span>
                <span class="close-button" onclick="closeModal('modalNouvelArrivage')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="formArrivage">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium">Fournisseur</label>
                            <input type="text" id="arrivageFournisseur" class="w-full"
                                placeholder="Ex: Pêcheurs de Kayar">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Date d'Arrivage</label>
                            <input type="date" id="arrivageDate" class="w-full">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Produits Reçus</label>
                        <div id="arrivageProduitsContainer">
                            <div class="grid grid-cols-12 gap-2 items-center mb-2 p-2 bg-gray-50 rounded">
                                <div class="col-span-5">
                                    <select class="w-full text-sm">
                                        <option>Thon Rouge</option>
                                        <option>Crevettes Roses</option>
                                        <option>Soles</option>
                                        <option>Bars</option>
                                        <option>Sardines</option>
                                    </select>
                                </div>
                                <div class="col-span-3">
                                    <input type="number" placeholder="Quantité" class="w-full text-sm">
                                </div>
                                <div class="col-span-3">
                                    <input type="number" placeholder="Prix/kg" class="w-full text-sm">
                                </div>
                                <div class="col-span-1 text-center">
                                    <button type="button" class="text-red-500 hover:text-red-700">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm mt-2">
                            <i class="fas fa-plus mr-2"></i>Ajouter un produit
                        </button>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium">Commentaires</label>
                        <textarea id="arrivageCommentaires" class="w-full" rows="3"
                            placeholder="Observations sur la qualité, conditions de transport, etc."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary mr-2"
                    onclick="closeModal('modalNouvelArrivage')">Annuler</button>
                <button type="button" class="btn btn-primary" onclick="enregistrerArrivage()">Enregistrer
                    Arrivage</button>
            </div>
        </div>
    </div>

    <script>
        console.log('Script loaded successfully'); // Debug log
        let currentUserRole = 'director';
        let charts = {};

        // Données de démonstration
        const productsData = [
            { id: 1, name: 'Thon Rouge', stockUnit: 'kg', priceType: 'Variable', basePrice: 6500 },
            { id: 2, name: 'Crevettes Roses', stockUnit: 'kg', priceType: 'Variable', basePrice: 8000 },
            { id: 3, name: 'Soles', stockUnit: 'kg', priceType: 'Variable', basePrice: 4500 },
            { id: 4, name: 'Bars', stockUnit: 'kg', priceType: 'Fixe', basePrice: 3500 },
            { id: 5, name: 'Sardines', stockUnit: 'kg', priceType: 'Fixe', basePrice: 1500 }
        ];

        const salesUnitsData = [
            { id: 1, name: 'Thon au Kg', baseProduct: 'Thon Rouge', price: 6500, factor: 1 },
            { id: 2, name: 'Pack de Thon 500g', baseProduct: 'Thon Rouge', price: 3500, factor: 0.5 },
            { id: 3, name: 'Crevettes au Kg', baseProduct: 'Crevettes Roses', price: 8000, factor: 1 },
            { id: 4, name: 'Barquette Crevettes 250g', baseProduct: 'Crevettes Roses', price: 2200, factor: 0.25 },
            { id: 5, name: 'Soles au Kg', baseProduct: 'Soles', price: 4500, factor: 1 },
            { id: 6, name: 'Bars au Kg', baseProduct: 'Bars', price: 3500, factor: 1 },
            { id: 7, name: 'Sardines au Kg', baseProduct: 'Sardines', price: 1500, factor: 1 }
        ];

        const usersData = [
            { id: 1, name: 'Directeur Général', login: 'directeur', role: 'Directeur', store: 'Tous', status: 'Actif' },
            { id: 2, name: 'Amadou Diallo', login: 'almadies', role: 'Magasin', store: 'Almadies', status: 'Actif' },
            { id: 3, name: 'Fatou Seck', login: 'sandaga', role: 'Magasin', store: 'Sandaga', status: 'Actif' },
            { id: 4, name: 'Moussa Ba', login: 'mermoz', role: 'Magasin', store: 'Mermoz', status: 'Inactif' }
        ];

        const employeesData = [
            { id: 1, name: 'Amadou Diallo', store: 'Almadies', role: 'Responsable', salary: 180000, status: 'Actif' },
            { id: 2, name: 'Fatou Seck', store: 'Sandaga', role: 'Responsable', salary: 175000, status: 'Actif' },
            { id: 3, name: 'Moussa Ba', store: 'Mermoz', role: 'Vendeur', salary: 120000, status: 'Inactif' },
            { id: 4, name: 'Aïcha Ndiaye', store: 'Almadies', role: 'Vendeur', salary: 125000, status: 'Actif' },
            { id: 5, name: 'Omar Sy', store: 'Hub', role: 'Préparateur', salary: 140000, status: 'Actif' }
        ];

        const storesData = [
            { id: 1, name: 'Hub de Distribution', type: 'Hub', address: 'Zone Industrielle, Dakar', status: 'Actif' },
            { id: 2, name: 'Pointe des Almadies', type: 'Magasin', address: 'Almadies, Dakar', status: 'Actif' },
            { id: 3, name: 'Sandaga', type: 'Magasin', address: 'Marché Sandaga, Dakar', status: 'Actif' },
            { id: 4, name: 'Mermoz', type: 'Magasin', address: 'Mermoz, Dakar', status: 'Inactif' }
        ];

        // Données supprimées car déjà définies plus haut

        console.log('All data loaded successfully'); // Debug confirmation

        function login() {
            console.log('Login function called'); // Debug log
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            initializeApp();
        }

        function logout() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('app').classList.add('hidden');
        }

        function switchUserRole() {
            currentUserRole = currentUserRole === 'director' ? 'gerant' : 'director';
            updateUIForRole();
        }

        function updateUIForRole() {
            const directorNav = document.getElementById('director-nav');
            const storeNav = document.getElementById('store-nav');
            const currentUserSpan = document.getElementById('currentUser');

            directorNav.style.display = currentUserRole === 'director' ? 'block' : 'none';
            storeNav.style.display = currentUserRole === 'gerant' ? 'block' : 'none';

            if (currentUserRole === 'director') {
                currentUserSpan.textContent = 'Vue: Directeur';
                showView('director-dashboard', document.querySelector('#director-nav .nav-link'));
            } else {
                currentUserSpan.textContent = 'Vue: Gérant (Almadies)';
                showView('store-dashboard', document.querySelector('#store-nav .nav-link'));
            }
        }

        function showView(viewId, clickedLink) {
            document.querySelectorAll('.view-content').forEach(view => view.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');

            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            if (clickedLink) clickedLink.classList.add('active');

            if (window.innerWidth < 1024) {
                document.getElementById('sidebar').classList.add('sidebar-closed');
            }
            updateDynamicViews();
            renderCharts(viewId);
        }

        function updateDynamicViews() {
            const directorStockView = document.getElementById('director-stock-view');
            const storeStockView = document.getElementById('store-stock-view');
            const directorHrView = document.getElementById('director-hr-view');
            const storeHrView = document.getElementById('store-hr-view');

            if (directorStockView) directorStockView.style.display = currentUserRole === 'director' ? 'block' : 'none';
            if (storeStockView) storeStockView.style.display = currentUserRole === 'gerant' ? 'block' : 'none';
            if (directorHrView) directorHrView.style.display = currentUserRole === 'director' ? 'block' : 'none';
            if (storeHrView) storeHrView.style.display = currentUserRole === 'gerant' ? 'block' : 'none';

            document.getElementById('store-dashboard-header').textContent = `Mon Magasin: Pointe des Almadies`;
            document.getElementById('saisieInfo').textContent = `Magasin: Pointe des Almadies | Date: ${new Date().toLocaleDateString('fr-FR')}`;
        }

        function switchTab(clickedTab, tabContainerId, tabContentId) {
            const container = document.getElementById(tabContainerId);
            container.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById(tabContentId).classList.remove('hidden');

            clickedTab.parentElement.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            clickedTab.classList.add('active');
        }

        function renderCharts(viewId) {
            Object.values(charts).forEach(chart => chart.destroy());
            charts = {};

            if (viewId === 'director-dashboard') {
                const ctx = document.getElementById('caChart').getContext('2d');
                charts.caChart = new Chart(ctx, {
                    type: 'bar',
                    data: { labels: ['Almadies', 'Sandaga', 'Mermoz'], datasets: [{ label: 'CA (milliers CFA)', data: [850, 720, 650], backgroundColor: ['#3b82f6', '#10b981', '#f97316'] }] },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }
            if (viewId === 'reports-view') {
                const ctx = document.getElementById('productPerfChart').getContext('2d');
                charts.productPerfChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: { labels: ['Thon Rouge', 'Crevettes', 'Soles', 'Bars'], datasets: [{ data: [40, 25, 15, 20], backgroundColor: ['#ef4444', '#f97316', '#84cc16', '#3b82f6'] }] },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }
            if (viewId === 'stock-management' && currentUserRole === 'director') {
                const ctx = document.getElementById('stockDistributionChart').getContext('2d');
                charts.stockDistributionChart = new Chart(ctx, {
                    type: 'pie',
                    data: { labels: ['Hub', 'Almadies', 'Sandaga', 'En Transit'], datasets: [{ label: 'Stock (Kg)', data: [1200, 450, 380, 75], backgroundColor: ['#6b7280', '#3b82f6', '#10b981', '#f59e0b'] }] },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }
        }

        function populateSalesTable() {
            const tableBody = document.getElementById('saisieTableBody');
            tableBody.innerHTML = '';
            ajouterLigneSaisie();
            ajouterLigneSaisie();
        }

        function ajouterLigneSaisie() {
            const tableBody = document.getElementById('saisieTableBody');
            const row = tableBody.insertRow();
            row.className = 'table-row';

            const cellProduct = row.insertCell();
            const select = document.createElement('select');
            select.onchange = () => updatePrice(row);
            salesUnitsData.forEach(u => select.add(new Option(`${u.name} (${u.baseProduct})`, u.id)));
            cellProduct.appendChild(select);

            row.insertCell().className = 'text-right';
            const cellQty = row.insertCell();
            const inputQty = document.createElement('input');
            inputQty.type = 'number';
            inputQty.className = 'w-24 p-1 border rounded-md text-center';
            inputQty.oninput = () => calculateSubtotal(row);
            cellQty.appendChild(inputQty);

            row.insertCell().className = 'text-right font-medium';
            const cellAction = row.insertCell();
            cellAction.className = 'text-center';
            const btnDelete = document.createElement('button');
            btnDelete.innerHTML = '<i class="fas fa-trash text-red-500"></i>';
            btnDelete.onclick = () => { row.remove(); calculateTotal(); };
            cellAction.appendChild(btnDelete);

            updatePrice(row);
        }

        function updatePrice(row) {
            const select = row.cells[0].querySelector('select');
            const selectedUnit = salesUnitsData.find(u => u.id == select.value);
            row.cells[1].textContent = `${selectedUnit.price.toLocaleString('fr-FR')} CFA`;
            calculateSubtotal(row);
        }

        function calculateSubtotal(row) {
            const priceText = row.cells[1].textContent.replace(/\s|CFA/g, '');
            const price = parseFloat(priceText);
            const quantity = parseFloat(row.cells[2].querySelector('input').value) || 0;
            const subtotal = price * quantity;
            row.cells[3].textContent = `${subtotal.toLocaleString('fr-FR')} CFA`;
            calculateTotal();
        }

        function calculateTotal() {
            let total = 0;
            document.querySelectorAll('#saisieTableBody tr').forEach(row => {
                const subtotalText = row.cells[3].textContent.replace(/\s|CFA/g, '');
                total += parseFloat(subtotalText) || 0;
            });
            document.getElementById('totalJournalier').textContent = `${total.toLocaleString('fr-FR')} CFA`;
        }

        function populateProductsTable() {
            const tableBody = document.getElementById('catalogueProduitsTableBody');
            tableBody.innerHTML = '';
            productsData.forEach(p => {
                const row = tableBody.insertRow();
                row.className = 'table-row';
                row.innerHTML = `<td>${p.name}</td><td>${p.stockUnit}</td><td><span class="px-2 py-1 text-xs font-medium rounded-full ${p.priceType === 'Variable' ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-800'}">${p.priceType}</span></td><td class="text-center"><button onclick="openModal('modalAjoutProduit')" class="text-blue-500 text-xs">Détails</button></td>`;
            });
        }

        function populateUsersAndEmployeesTables() {
            const usersBody = document.getElementById('usersTableBody');
            const employeesBody = document.getElementById('employeeTableBody');
            usersBody.innerHTML = '';
            employeesBody.innerHTML = '';

            usersData.forEach(u => {
                let row = usersBody.insertRow();
                row.className = 'table-row';
                row.innerHTML = `<td>${u.name}</td><td>${u.login}</td><td>${u.role}</td><td>${u.store}</td><td class="text-center"><span class="px-2 py-1 text-xs font-medium rounded-full ${u.status === 'Actif' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${u.status}</span></td><td class="text-center"><button class="text-blue-500 text-xs">Modifier</button></td>`;
            });

            employeesData.forEach(e => {
                let row = employeesBody.insertRow();
                row.className = 'table-row';
                row.innerHTML = `<td>${e.name}</td><td>${e.store}</td><td>${e.role}</td><td class="text-right">${e.salary ? e.salary.toLocaleString('fr-FR') + ' CFA' : 'N/A'}</td><td class="text-center"><span class="px-2 py-1 text-xs font-medium rounded-full ${e.status === 'Actif' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${e.status}</span></td><td class="text-center"><button onclick="openModal('modalAjoutEmploye')" class="text-blue-500 text-xs">Détails</button></td>`;
            });
        }

        function ajouterUtilisateur() {
            const nom = document.getElementById('utilisateurNomComplet').value;
            const login = document.getElementById('utilisateurIdentifiant').value;
            const role = document.getElementById('utilisateurRole').value;
            const magasin = document.getElementById('utilisateurMagasin').value;

            if (!nom || !login) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }

            const newUser = {
                id: usersData.length + 1,
                name: nom,
                login: login,
                role: role === 'directeur' ? 'Directeur' : 'Magasin',
                store: magasin || 'Tous',
                status: 'Actif'
            };

            usersData.push(newUser);
            populateUsersAndEmployeesTables();
            closeModal('modalAjoutUtilisateur');

            // Reset form
            document.getElementById('formUtilisateur').reset();

            alert('Utilisateur créé avec succès !');
        }

        function ajouterEmploye() {
            const nom = document.getElementById('employeNom').value;
            const telephone = document.getElementById('employeTelephone').value;
            const magasin = document.getElementById('employeMagasin').value;
            const role = document.getElementById('employeRole').value;
            const salaire = document.getElementById('employeSalaire').value;

            if (!nom || !magasin || !role) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }

            const newEmployee = {
                id: employeesData.length + 1,
                name: nom,
                store: magasin.charAt(0).toUpperCase() + magasin.slice(1),
                role: role.charAt(0).toUpperCase() + role.slice(1),
                salary: parseInt(salaire) || 0,
                status: 'Actif'
            };

            employeesData.push(newEmployee);
            populateUsersAndEmployeesTables();
            closeModal('modalAjoutEmploye');

            // Reset form
            document.getElementById('formEmploye').reset();

            alert('Employé créé avec succès !');
        }

        function ajouterMagasin() {
            const nom = document.getElementById('magasinNom').value;
            const type = document.getElementById('magasinType').value;
            const adresse = document.getElementById('magasinAdresse').value;
            const telephone = document.getElementById('magasinTelephone').value;

            if (!nom || !adresse) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }

            const newStore = {
                id: storesData.length + 1,
                name: nom,
                type: type === 'hub' ? 'Hub' : 'Magasin',
                address: adresse,
                status: 'Actif'
            };

            storesData.push(newStore);
            populateStoresTable();
            closeModal('modalAjoutMagasin');

            // Reset form
            document.getElementById('formMagasin').reset();

            alert('Magasin créé avec succès !');
        }

        function enregistrerArrivage() {
            const fournisseur = document.getElementById('arrivageFournisseur').value;
            const date = document.getElementById('arrivageDate').value;
            const commentaires = document.getElementById('arrivageCommentaires').value;

            if (!fournisseur || !date) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }

            closeModal('modalNouvelArrivage');
            document.getElementById('formArrivage').reset();
            alert('Arrivage enregistré avec succès !');
        }

        function populateStoresTable() {
            const storesBody = document.getElementById('storesTableBody');
            if (!storesBody) return;

            storesBody.innerHTML = '';
            storesData.forEach(s => {
                let row = storesBody.insertRow();
                row.className = 'table-row';
                row.innerHTML = `
                    <td>${s.name}</td>
                    <td>${s.type}</td>
                    <td>${s.address}</td>
                    <td class="text-center">
                        <span class="px-2 py-1 text-xs font-medium rounded-full ${s.status === 'Actif' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${s.status}
                        </span>
                    </td>
                    <td class="text-center">
                        <button class="text-blue-500 text-xs">Modifier</button>
                    </td>
                `;
            });
        }

        function initializeApp() {
            console.log('InitializeApp function called'); // Debug log
            updateUIForRole();
            populateSalesTable();
            populateProductsTable();
            populateUsersAndEmployeesTables();
            populateStoresTable();
        }

        function validerNouveauxPrix() {
            const confirmation = confirm('Êtes-vous sûr de vouloir appliquer ces nouveaux prix ? Cette action sera immédiatement visible par tous les magasins.');
            if (confirmation) {
                alert('Prix mis à jour avec succès ! Tous les magasins ont été notifiés.');
                // Ici on pourrait mettre à jour l'heure de dernière modification
                const now = new Date();
                const timeString = now.toLocaleString('fr-FR');
                document.querySelector('.text-gray-600').innerHTML = `<i class="fas fa-calendar mr-1"></i>Dernière mise à jour: ${timeString}`;
            }
        }

        function openModal(modalId) { document.getElementById(modalId).style.display = "block"; }
        function closeModal(modalId) { document.getElementById(modalId).style.display = "none"; }

        document.getElementById('menuToggle').addEventListener('click', () => document.getElementById('sidebar').classList.toggle('sidebar-closed'));

        window.onclick = function (event) {
            document.querySelectorAll('.modal').forEach(modal => {
                if (event.target == modal) modal.style.display = "none";
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Setup login form event listener
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();

                    // Simple validation
                    const username = document.getElementById('username').value;
                    const password = document.getElementById('password').value;

                    if (!username || !password) {
                        alert('Veuillez saisir votre identifiant et mot de passe');
                        return;
                    }

                    // For demo purposes, accept any credentials
                    login();
                });
            }

            // Auto-login removed - users can now use the login form

            // Set today's date for attendance
            const today = new Date().toISOString().split('T')[0];
            const datePointage = document.getElementById('datePointage');
            if (datePointage) {
                datePointage.value = today;
            }

            // Set today's date for arrival form
            const arrivageDate = document.getElementById('arrivageDate');
            if (arrivageDate) {
                arrivageDate.value = today;
            }
        });
    </script>
</body>

</html>